echo "Olá $USER tudo bem?"
echo "Eu sou o Ricardo Lourenço (Neo), Desenvolvedor e Maintainer do NEORICALEX"
echo "Desde já o meu muito obrigado por testar tanto o NEORICALEX, quanto indiretamente o meu \"filhinho\" chamado NFDOS :-)"
echo "Vou começar por checkar qual é a distribuição Linux que o $HOSTNAME está executando."
echo "Aguarde 10 segundinhos por favor ..."
sleep 10
# REF: https://stackoverflow.com/questions/29581754/how-to-find-linux-distribution-name-using-shell-script
UNAME=$(uname | tr "[:upper:]" "[:lower:]")
if [ "$UNAME" == "linux" ]; then
    if [ -f /etc/lsb-release -o -d /etc/lsb-release.d ]; then
        DISTRO=$(lsb_release -i | cut -d: -f2 | sed s/'^\t'//)
    else
        DISTRO=$(ls -d /etc/[A-Za-z]*[_-][rv]e[lr]* | grep -v "lsb" | cut -d'/' -f3 | cut -d'-' -f1 | cut -d'_' -f1)
    fi
fi
[ "$DISTRO" == "" ] && export DISTRO=$UNAME
unset UNAME

if [ "$DISTRO" == "Ubuntu" ]; then
    echo "Aparentemente o $HOSTNAME está rodando o $DISTRO. Tudo OK então :-)"
else
    echo "Aparentemente o $HOSTNAME não está rodando no Ubuntu. O $USER tem o apt instalado?"
    echo "# TODO: Checkar se o USER tem o APT instalado."
    sleep 3
fi
unset DISTRO

echo "Vamos atualizar os repositórios e atualizar o $HOSTNAME..."
sudo apt update && sudo apt upgrade -y

echo "Setar algumas variáveis de ambiente para nos facilitar a vida..."
export NEORICALEX=$(pwd)
export NEORICALEX_DEV=$NEORICALEX/desktop
export NEORICALEX_DEV_BACKEND=$NEORICALEX_DEV/backend

export NFDOS_ROOT=$NEORICALEX_DEV/0.1
export NFDOS_ROOTFS=$NFDOS_ROOT/rootfs
export NFDOS_DISCO=$NFDOS_ROOT/nfdos.img

export NFDOS_DEV=$NFDOS_ROOT/testes/nfdos

echo "Criar a imagem de disco ... "
testar_nfdos() {
    # INFO: Função para medir o tempo de "Compilação". 
    #       Não queremos que todo o processo demore mais que as antigas instalações do Windows.
    #       Tempo que temos para fazer, montar e/ou compilar tudo: 45 minutos
    #       Tempo atual em um AMD FX 8350, 8 Cores, 16GB RAM, 100MB/s de Conexão Internet: 16 Minutos
    echo "Instalar as dependencias do NFDOS.."
    sudo apt install -y \
        binutils \
        debootstrap \
        squashfs-tools \
        xorriso \
        grub-pc-bin \
        grub-efi-amd64-bin \
        mtools

    bash desktop/0.1/shell  
}
time testar_nfdos

#bash dev/backend/shell

echo ""
echo "Por agora é tudo."
echo "Obrigado e até já !"

#echo "Iniciando o QEMU..."
#qemu-system-x86_64 -m 1024  -cdrom $NFDOS_ROOT/nfdos.iso

